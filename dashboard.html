<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BrahmaTech Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js"></script>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #fff0f5;
    margin: 0;
    padding: 0;
    color: #333;
  }
  header {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: #ffb6c1;
    color: white;
  }
  header img {
    border-radius: 50%;
    width: 50px;
    height: 50px;
  }
  .container {
    padding: 20px;
    max-width: 900px;
    margin: auto;
  }
  h1 {
    text-align: center;
    color: #ff4da6;
  }
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 15px;
    margin-top: 20px;
  }
  .stat-card {
    background: white;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }
  .stat-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #ff4da6;
  }
  .badges {
    margin-top: 30px;
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }
  .badge-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }
  .badge {
    background: #ffccdd;
    padding: 6px 12px;
    border-radius: 12px;
    font-weight: bold;
    font-size: 0.9rem;
  }
</style>
</head>
<body>

<header>
  <img id="serverIcon" src="" alt="Server Icon">
  <div>
    <div id="serverName" style="font-size:1.2rem; font-weight:bold;"></div>
    <div id="userName" style="font-size:0.9rem;"></div>
  </div>
</header>

<div class="container">
  <h1>Your Stats</h1>
  <div id="statsGrid" class="stats-grid">Loading stats...</div>

  <div class="badges">
    <h2>Badges</h2>
    <div id="badgeList" class="badge-list"></div>
  </div>
</div>

<script>
  // Firebase Config (replace with yours)
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const guildData = JSON.parse(localStorage.getItem("selectedGuild"));
  const token = localStorage.getItem("accessToken");

  if (!guildData || !token) {
    alert("No guild or token found. Please login again.");
    window.location.href = "login.html";
  }

  document.getElementById("serverName").innerText = guildData.name;
  document.getElementById("serverIcon").src = guildData.icon 
    ? `https://cdn.discordapp.com/icons/${guildData.id}/${guildData.icon}.png`
    : "https://cdn.discordapp.com/embed/avatars/0.png";

  // Get user info from Discord
  fetch("https://discord.com/api/users/@me", {
    headers: { Authorization: `Bearer ${token}` }
  })
  .then(res => res.json())
  .then(user => {
    document.getElementById("userName").innerText = `${user.username}#${user.discriminator}`;
    const userId = user.id;

    // Fetch stats from Firestore
    const docId = `${guildData.id}_${userId}`;
    db.collection("users").doc(docId).get().then(docSnap => {
      if (!docSnap.exists) {
        document.getElementById("statsGrid").innerHTML = "<p>No stats found.</p>";
        return;
      }
      const data = docSnap.data();
      renderStats(data);
    });
  });

  function renderStats(data) {
    const stats = [
      { label: "Level", value: data.level },
      { label: "XP", value: data.xp },
      { label: "Coins", value: data.coins },
      { label: "Gems", value: data.gems },
      { label: "VC Time (s)", value: data.vcTime },
      { label: "Study Hours", value: data.study_hours },
      { label: "Daily Msg Count", value: data.dailyMessageCount },
      { label: "Streak", value: data.streak },
      { label: "Warnings", value: data.warnings }
    ];

    const grid = document.getElementById("statsGrid");
    grid.innerHTML = "";
    stats.forEach(stat => {
      const card = document.createElement("div");
      card.className = "stat-card";
      card.innerHTML = `
        <div class="stat-value">${stat.value ?? 0}</div>
        <div>${stat.label}</div>
      `;
      grid.appendChild(card);
    });

    // Render badges
    const badgeList = document.getElementById("badgeList");
    badgeList.innerHTML = "";
    if (Array.isArray(data.badges)) {
      data.badges.forEach(badge => {
        const b = document.createElement("div");
        b.className = "badge";
        b.innerText = badge;
        badgeList.appendChild(b);
      });
    }
  }
</script>

</body>
</html>
