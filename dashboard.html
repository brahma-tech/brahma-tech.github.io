<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BrahmaTech Bot Dashboard</title>
<style>
  body {
    background: #0d0d0d;
    color: white;
    font-family: 'Segoe UI', sans-serif;
    text-align: center;
    padding-top: 50px;
  }
  .avatar {
    border-radius: 50%;
  }
  #logout-btn {
    background: crimson;
    color: white;
    padding: 10px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 20px;
  }
</style>
</head>
<body>

<div id="content">
  <h1>Loading...</h1>
</div>

<script>
// Check OAuth token from URL or stored user
if (window.location.hash.includes("access_token")) {
  const params = new URLSearchParams(window.location.hash.substring(1));
  fetch("https://discord.com/api/users/@me", {
    headers: { Authorization: `Bearer ${params.get("access_token")}` }
  })
  .then(res => res.json())
  .then(user => {
    localStorage.setItem("discordUser", JSON.stringify(user));
    renderDashboard(user);
    window.history.replaceState({}, document.title, window.location.pathname);
  });
} else {
  const storedUser = localStorage.getItem("discordUser");
  if (storedUser) {
    renderDashboard(JSON.parse(storedUser));
  } else {
    window.location.href = "login.html"; // Not logged in
  }
}

function renderDashboard(user) {
  document.getElementById("content").innerHTML = `
    <h1>Welcome, ${user.username}#${user.discriminator}</h1>
    <img class="avatar" src="https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png" width="100"><br>
    <button id="logout-btn">Logout</button>
  `;

  document.getElementById("logout-btn").addEventListener("click", () => {
    localStorage.removeItem("discordUser");
    window.location.href = "login.html";
  });
}
</script>

</body>
</html>
